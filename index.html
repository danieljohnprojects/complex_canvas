<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Test</title>

    <!-- Link the JSXGraph library -->
    <script type="text/javascript" charset="UTF-8"
        src="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraphcore.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraph.css" />

    <!-- Link the math library -->
    <script type="text/javascript" src="math.js"></script>
    <!-- Link the geometry helpers -->
    <script type="text/javascript" src="geometry.js"></script>
</head>

<body>
    <!-- The field to define the function  -->
    <div id="input">
        f(z) = <input type="text" id="userFunction" name="Function" autocomplete="off" value="z">
        <input id="go" type="button" value="Go!">
        <input id="clear" type="button" value="Clear">
        <script type="text/javascript" src="buttons.js"></script>
    </div>

    <div id="graphArea">
        <div id="inputBox" class="jxgbox" style="width:500px; height:500px;"></div>
        <div id="outputBox" class="jxgbox" style="width:500px; height:500px;"></div>
        <script type="text/javascript">
            var zboard = JXG.JSXGraph.initBoard('inputBox', {
                boundingbox: [-5, 5, 5, -5],
                axis: true
            });
            var wboard = JXG.JSXGraph.initBoard('outputBox', {
                boundingbox: [-5, 5, 5, -5],
                axis: true
            });
            zboard.curves = []
            wboard.curves = []
            
            var funcstr = "z";
            var transform_func = math.parse(funcstr);

            function transform(coords) {
                var z = math.complex(coords[0], coords[1]);
                var w = transform_func.evaluate({z:z});
                return [math.re(w), math.im(w)];
            }

            var z_curve = null;
            var w_curve = null;

            zboard.on(
                'down',
                function (evt) {
                    var z = event_coords(evt, zboard);
                    z_curve = zboard.create(
                        "curve", 
                        [[z[0]], [z[1]]],
                        {highlight: false}
                    );
                    var w = transform(z);
                    w_curve = wboard.create("curve", [[w[0]], [w[1]]]);
                }
            );
            zboard.on(
                'up',
                function (evt) { 
                    // Keep track of the curves so we can delete 
                    // them later
                    zboard.curves.push(z_curve);
                    wboard.curves.push(w_curve);
                    z_curve = null; 
                    w_curve = null; }
            );
            zboard.on(
                'move',
                function (evt) {
                    if (z_curve !== null) {
                        var z = event_coords(evt, zboard);
                        var w = transform(z);
                        z_curve.dataX.push(z[0]);
                        z_curve.dataY.push(z[1]);
                        w_curve.dataX.push(w[0]);
                        w_curve.dataY.push(w[1]);
                        zboard.update();
                        wboard.update();
                    }
                }
            )
        </script>
    </div>
</body>

</html>